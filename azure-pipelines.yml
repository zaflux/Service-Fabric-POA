resources:
  repositories:
  - repository: PatchOrchestrationApplication
    type: git
    name: Infrastructure/PatchOrchestrationApplication

trigger:
- master

pool:
  vmImage: 'VS2017-Win2016'

steps:
- checkout: self
- checkout: PatchOrchestrationApplication

- task: PowerShell@2
  displayName: 'Build Code'
  inputs:
    targetType: filePath
    filePath: './build.ps1'

- task: CmdLine@2
  inputs:
    script: 'dir /s'
    workingDirectory: '$(Build.SourcesDirectory)'

#- task: CopyFiles@2
#  inputs:
#    SourceFolder: '$(Build.SourcesDirectory)\out\Release\'
#    Contents: '**'
#    TargetFolder: '$(Build.ArtifactStagingDirectory)'

- task: CopyFiles@2
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)\out\Release\PatchOrchestrationApplication'
    Contents: '**'
    TargetFolder: '$(Build.ArtifactStagingDirectory)\CodePackage'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'POA'
    publishLocation: 'Container'